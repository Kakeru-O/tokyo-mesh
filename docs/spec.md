# アプリケーション仕様書：Tokyo Mesh Insight AI

## 1. コンセプト
東京都の地域メッシュ統計（人口・世代）を可視化し、AIエージェントがその地域の特性を分析・解説する、データドリブンな意思決定支援アプリ。

## 2. 学習目標
- **自作ロジックの実装:** 緯度経度・メッシュ変換コードを外部モジュールとして組み込む。
- **AIエージェント制御:** Gemini APIの「Function Calling」を使い、AIに自ら関数を実行させる技術の習得。
- **モダンなUI開発:** Streamlitを用いた対話型インターフェースと地図（Pydeck/Folium）の高度な連携。
- **データエンジニアリング:** 大容量のメッシュ統計データ（e-Stat）を高速に処理する（Pandas/Parquet）。

## 3. 使用データ・技術スタック
### A. データソース
1. **人口統計データ:** e-Stat「令和2年国勢調査 500mメッシュ統計（東京都）」
   - 項目：総人口、年齢階層別（5歳刻み）、男女別人口。
2. **位置情報:** ジオコーディング（Nominatim）または地図クリックによる座標取得。

### B. 技術スタック
- **Language:** Python 3.10+
- **Frontend:** Streamlit
- **AI Engine:** Google Gemini 2.5 Flash (via Google AI ADK)
- **Map Visualization:** Pydeck (3D/2Dヒートマップ)
- **Data Handling:** Pandas / PyArrow (Parquet形式)

## 4. 主要機能
### ① インタラクティブ・メッシュマップ
- **世代別フィルター:** スライダーやセレクトボックスで「20代」「子育て世代」「高齢者」などの属性を選択。
- **ビジュアライゼーション:** - 選択した属性の密度を地図上に色（Choropleth）で表現。
    - 人口総数をメッシュの高さ（3D Column）で表現。

### ② AI分析エージェント（The Analyst）
- **Function Callingの実装:** - AIが「特定の住所の緯度経度を取得」→「メッシュコードへ変換」→「統計DBから値を抽出」というプロセスを自律的に実行。
- **知的な解説:** 抽出した数値に基づき、「このエリアは20代が平均より多いため、単身者向けのトレンドが生まれやすい」といった文脈のある解説を提供。

### ③ エリア・ネーミング機能（お遊び・独自性）
- 分析したメッシュに対し、AIが統計的特徴から「クリエイティブ・ハブ」「静寂のシルバータウン」など、ユニークな地域名を自動生成する。

## 5. アプリケーション構成案
```text
tokyo-mesh/
├── app.py                # Streamlit メインアプリ（UI・地図制御）
├── utils/
│   ├── mesh_converter.py # ユーザー自作の緯度経度・メッシュ変換ロジック
│   └── ai_agent.py       # Gemini APIの定義とFunction Callingの設定
├── data/
│   ├── raw/              # e-Statから取得したCSV
│   └── processed/        # 高速読み込み用に変換したParquetファイル
└── pyproject.toml        # 依存ライブラリ
```

## 6. 開発ロードマップ

### Step 1: データの整形

e-StatのCSVを読み込み、不要な列の削除や型変換を行いParquet形式で保存。

### Step 2: 可視化の構築

Streamlit + Pydeckで東京都の人口を地図上に表示。フィルターで色が変わることを確認。

### Step 3: 自作関数のツール化

変換コードを関数化し、Gemini APIが「道具」として認識できるようにラッパーを作成。

### Step 4: 地図にメッシュを表示

### Step 5: エージェントの実装

チャットで「渋谷駅周辺の30代の人口は？」と聞いて、AIが正しく関数を呼び出し回答できるかテスト。

## 7. 実現可能性の確認

- データ量: 東京都の500mメッシュは約1万件程度であり、Pandas/Parquetでメモリ内に保持・即時処理が十分可能。
- コスト: Gemini APIの無料枠内で開発可能。
- 技術難易度: 緯度経度変換コードが既にあるため、最大の難関はAI ADKのFunction Calling設定のみ。